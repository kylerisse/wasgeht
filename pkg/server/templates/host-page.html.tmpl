<!doctype html>
<html lang="en" data-theme="light">
	<head>
		<meta charset="UTF-8" />
		<title>Was Geht: {{ .Hostname }}</title>
		<link rel="stylesheet" href="/vendor/pico-2.1.1.classless.min.css" />
		<link rel="stylesheet" href="/app.css" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
	</head>
	<body x-data="hostdetail">
		<main class="full-width-main">
			<!-- Top bar: nav + global summary (unfiltered) -->
			<div class="summary-bar">
				<a href="/">Dashboard</a>
				<a href="/grid-view.html">Grid</a>
				<template x-for="entry in summaryEntries()">
					<span x-bind:class="summaryBadgeClass(entry)">
						<span x-text="entry.status"></span>
						<span x-text="entry.count"></span>
					</span>
				</template>
				<span class="summary-bar-spacer"></span>
				<div class="omitted-dropdown" x-show="hasOmitted()">
					<button class="clear-omitted-btn" x-text="omittedText()"></button>
					<div class="omitted-dropdown-menu">
						<button class="omitted-dropdown-item" x-on:click="clearOmitted()">Restore all</button>
						<template x-for="h in omitted">
							<button class="omitted-dropdown-item" x-on:click="restoreHost(h)" x-text="h"></button>
						</template>
					</div>
				</div>
			</div>

			<!-- Host header -->
			<div class="host-header">
				<h1>{{ .Hostname }}</h1>
				<div class="host-tags">
					<template x-for="tag in hostTags()">
						<span class="host-tag" x-text="tagText(tag)"></span>
					</template>
				</div>
			</div>

			<!-- Check detail cards -->
			<div class="check-cards">
				<template x-for="ct in checkTypes">
					<div x-bind:class="checkCardClass(ct)" x-on:click="toggleCheck(ct)">
						<div class="check-card-header">
							<span class="check-card-name" x-text="checkLabel(ct)"></span>
							<span class="check-card-lastupdate" x-text="checkLastUpdate(ct)"></span>
						</div>
						<div class="check-card-metrics">
							<template x-for="m in checkMetricEntries(ct)">
								<div class="check-card-metric">
									<span class="check-card-metric-name" x-text="m.key"></span>
									<span class="check-card-metric-value" x-text="m.value"></span>
								</div>
							</template>
						</div>
					</div>
				</template>
				<button class="filter-clear-btn" x-show="hasActiveCheck()" x-on:click="clearChecks()" title="Show all checks">&#x2715;</button>
				</div>

			<!-- Graph table: rows = time ranges, columns = check types -->
			<table class="graph-table">
				<thead>
					<tr>
						<th></th>
						<template x-for="ct in visibleCheckTypes()">
							<th x-text="checkLabel(ct)"></th>
						</template>
					</tr>
				</thead>
				<tbody>
					<template x-for="t in allTimes">
						<tr>
							<td class="time-label" x-text="t.label"></td>
							<template x-for="ct in visibleCheckTypes()">
								<td>
									<img x-bind:src="graphImgSrc(ct, t)"
										x-bind:alt="graphAlt(ct, t)"
										x-on:click="openModal(ct, t)" />
								</td>
							</template>
						</tr>
					</template>
				</tbody>
			</table>

			<p x-show="loading">Loading...</p>

			<!-- Full-size graph modal -->
			<div class="graph-modal-overlay" x-show="modalOpen" x-on:click="closeModal()">
				<div class="graph-modal-content">
					<img x-bind:src="modalSrc" x-bind:alt="modalAlt" />
				</div>
			</div>
		</main>

		<script src="/vendor/alpine-csp-3.15.8.min.js" defer></script>
		<script src="/app.js"></script>
	</body>
</html>
